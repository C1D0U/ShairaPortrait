/* ==============================
   SHAIRAPORTRAIT â€” Valentine's Day
   ============================== */

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --rose:      #c9344a;
  --roseDark:  #8b1a2b;
  --roseLight: #f2c4cc;
  --cream:     #fdf5ec;
  --gold:      #d4a042;
  --goldLight: #f0d080;
  --ink:       #1a0a0d;
  --parchment: #f8eed8;
}

html, body {
  width: 100%; height: 100%;
  overflow: hidden;
  background: #0d0306;
  font-family: 'Cormorant Garamond', serif;
  cursor: default;
}

/* ========== SHARED ========== */
.stage {
  position: fixed; inset: 0;
  display: flex; align-items: center; justify-content: center;
}

/* ========== STAGE VISIBILITY ========== */
#envelope-stage,
#letter-stage,
#main-stage {
  position: fixed; inset: 0;
  display: flex; align-items: center; justify-content: center;
  transition: opacity 0.9s ease, visibility 0.9s ease;
}
#letter-stage,
#main-stage {
  opacity: 0; visibility: hidden; pointer-events: none;
}
#letter-stage.active,
#main-stage.active {
  opacity: 1; visibility: visible; pointer-events: all;
}

/* ========== PETAL BACKGROUND ========== */
.petals-bg {
  position: fixed; inset: 0;
  pointer-events: none;
  background: radial-gradient(ellipse at 50% 60%, #2a0510 0%, #0d0306 70%);
}

.petal {
  position: absolute;
  width: 10px; height: 14px;
  border-radius: 50% 50% 50% 0;
  background: var(--rose);
  opacity: 0.18;
  animation: petalFall linear infinite;
}

@keyframes petalFall {
  0%   { transform: translateY(-40px) rotate(0deg); opacity: 0; }
  10%  { opacity: 0.18; }
  90%  { opacity: 0.12; }
  100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

/* ========== ENVELOPE ========== */
#envelope-wrap {
  display: flex; flex-direction: column; align-items: center; gap: 18px;
  position: relative; z-index: 2;
}

#envelope {
  position: relative;
  width: 320px; height: 220px;
  cursor: pointer;
  filter: drop-shadow(0 20px 60px rgba(180,40,60,0.45));
  transition: transform 0.3s ease;
}
#envelope:hover { transform: scale(1.03) translateY(-4px); }

.env-back {
  position: absolute; inset: 0;
  background: linear-gradient(160deg, #8b1a2b 0%, #5a0d1c 100%);
  border-radius: 4px;
}

.env-flap {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 50%;
  background: linear-gradient(160deg, #c9344a 0%, #8b1a2b 100%);
  clip-path: polygon(0 0, 100% 0, 50% 100%);
  transform-origin: top center;
  transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  border-radius: 4px 4px 0 0;
  z-index: 4;
}
.env-flap.open {
  transform: rotateX(180deg);
}

.env-body {
  position: absolute; inset: 0;
  background: linear-gradient(170deg, #7a1525 0%, #4a0a15 100%);
  border-radius: 4px;
  display: flex; align-items: flex-end; justify-content: center;
  overflow: hidden;
  z-index: 3;
}

.env-letter-peek {
  width: 86%; height: 70%;
  background: var(--parchment);
  border-radius: 3px 3px 0 0;
  transform: translateY(30px);
  transition: transform 0.7s ease 0.6s;
  display: flex; align-items: center; justify-content: center;
  border: 1px solid rgba(212,160,66,0.3);
}
.env-letter-peek.risen { transform: translateY(-10px); }
.env-letter-peek span {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  color: var(--roseDark);
  font-size: 1rem;
  opacity: 0;
  transition: opacity 0.4s ease 1s;
}
.env-letter-peek.risen span { opacity: 1; }

.env-left {
  position: absolute;
  top: 0; left: 0; bottom: 0; width: 50%;
  background: linear-gradient(170deg, #9e1e30 0%, #601020 100%);
  clip-path: polygon(0 0, 100% 50%, 0 100%);
  z-index: 2;
}
.env-right {
  position: absolute;
  top: 0; right: 0; bottom: 0; width: 50%;
  background: linear-gradient(170deg, #8b1a2b 0%, #5a1020 100%);
  clip-path: polygon(0 50%, 100% 0, 100% 100%);
  z-index: 2;
}
.env-bottom {
  position: absolute;
  bottom: 0; left: 0; right: 0; height: 50%;
  background: linear-gradient(10deg, #4a0a15 0%, #7a1525 100%);
  clip-path: polygon(0 100%, 50% 0, 100% 100%);
  z-index: 2;
}

.wax-seal {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 54px; height: 54px;
  background: radial-gradient(circle at 35% 35%, var(--gold), #9a6010);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  z-index: 5;
  box-shadow: 0 4px 16px rgba(0,0,0,0.5), inset 0 1px 2px rgba(255,220,100,0.4);
  transition: transform 0.3s ease, opacity 0.5s ease;
}
.wax-seal.hide { transform: translate(-50%,-50%) scale(0); opacity: 0; }
.seal-inner {
  font-size: 1.5rem; color: #4a2000;
  text-shadow: 0 1px 1px rgba(255,200,80,0.5);
}

.tap-hint {
  font-family: 'Cormorant Garamond', serif;
  font-style: italic;
  font-size: 0.9rem;
  color: rgba(255,200,200,0.45);
  letter-spacing: 0.15em;
  animation: pulse 2.5s ease-in-out infinite;
}
@keyframes pulse {
  0%, 100% { opacity: 0.45; }
  50% { opacity: 0.9; }
}

/* ========== LETTER STAGE ========== */
#letter-stage {
  background: radial-gradient(ellipse at center, #1a0508 0%, #060002 100%);
}

.letter-paper {
  background: var(--parchment);
  border-radius: 3px;
  padding: 32px 28px 28px;
  width: min(90vw, 600px);
  max-height: 92vh;
  overflow-y: auto;
  box-shadow:
    0 0 0 1px rgba(212,160,66,0.25),
    0 0 0 6px rgba(139,26,43,0.1),
    0 30px 80px rgba(0,0,0,0.8),
    0 0 60px rgba(180,40,60,0.15);
  transform: translateY(30px);
  transition: transform 0.8s ease;
  position: relative;
}
.letter-paper::before,
.letter-paper::after {
  content: '';
  position: absolute;
  inset: 8px;
  border: 1px solid rgba(212,160,66,0.2);
  border-radius: 2px;
  pointer-events: none;
}
.letter-paper::after {
  inset: 12px;
  border-color: rgba(212,160,66,0.1);
}
#letter-stage.active .letter-paper { transform: translateY(0); }

.letter-inner {
  display: flex; flex-direction: column; align-items: center; gap: 20px;
}

/* ========== TYPOGRAPHIC PORTRAIT ========== */
.typo-portrait-container {
  width: 100%; max-width: 520px;
  border: 1px solid rgba(139,26,43,0.2);
}
#typoCanvas {
  width: 100%; height: auto;
  display: block;
}

.letter-footer {
  text-align: center;
  display: flex; flex-direction: column; align-items: center; gap: 16px;
}
.letter-subtitle {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  color: var(--roseDark);
  font-size: 0.9rem;
  letter-spacing: 0.05em;
}

#continueBtn {
  font-family: 'Playfair Display', serif;
  font-size: 1rem;
  letter-spacing: 0.2em;
  color: var(--cream);
  background: linear-gradient(135deg, var(--rose), var(--roseDark));
  border: none;
  padding: 12px 36px;
  border-radius: 2px;
  cursor: pointer;
  box-shadow: 0 6px 24px rgba(180,40,60,0.4);
  transition: transform 0.2s, box-shadow 0.2s;
}
#continueBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 30px rgba(180,40,60,0.55);
}

/* ========== MAIN STAGE ========== */
#main-stage {
  background: #0d0306;
}

.portrait-bg {
  position: fixed; inset: 0;
  background-image: url('photo.png');
  background-size: cover;
  background-position: center top;
  opacity: 0;
  transition: opacity 1.8s ease;
  filter: grayscale(20%) sepia(10%);
  transform: scale(1.04);
  cursor: pointer;
}
#main-stage.active .portrait-bg { opacity: 1; }

.vignette {
  position: fixed; inset: 0;
  background: radial-gradient(ellipse at center, transparent 30%, rgba(10,2,5,0.85) 100%);
  pointer-events: none;
}

.overlay-tint {
  position: fixed; inset: 0;
  background: rgba(30, 0, 8, 0.38);
  pointer-events: none;
}

/* ========== FLOATING HEARTS ========== */
.floating-hearts { position: fixed; inset: 0; pointer-events: none; }
.fheart {
  position: absolute;
  bottom: -30px;
  font-size: 1.2rem;
  opacity: 0;
  animation: floatUp linear infinite;
  color: rgba(220,80,100,0.6);
}
@keyframes floatUp {
  0%   { transform: translateY(0) scale(0.8) rotate(-10deg); opacity: 0; }
  15%  { opacity: 0.7; }
  85%  { opacity: 0.4; }
  100% { transform: translateY(-110vh) scale(1.2) rotate(15deg); opacity: 0; }
}

/* ========== MESSAGE CARD ========== */
.main-content {
  position: relative; z-index: 5;
  display: flex; align-items: center; justify-content: center;
  width: 100%; height: 100%;
}

.message-card {
  text-align: center;
  padding: 48px 44px;
  background: rgba(10,2,5,0.62);
  border: 1px solid rgba(212,160,66,0.28);
  border-radius: 2px;
  backdrop-filter: blur(8px);
  box-shadow:
    0 0 0 4px rgba(139,26,43,0.12),
    0 30px 80px rgba(0,0,0,0.6);
  max-width: 500px;
  width: 90vw;
  transform: translateY(20px);
  opacity: 0;
  animation: cardReveal 1.2s ease 0.6s forwards;
  position: relative;
  cursor: pointer;
  /* transition kicks in AFTER animation is stripped by JS */
  transition: opacity 0.55s ease, transform 0.55s ease;
}
@keyframes cardReveal {
  to { transform: translateY(0); opacity: 1; }
}

.card-deco {
  font-size: 0.7rem;
  letter-spacing: 0.5em;
  color: var(--gold);
  opacity: 0.6;
  margin-bottom: 16px;
}
.bottom-deco { margin-top: 16px; margin-bottom: 0; }

.main-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(2rem, 5vw, 3rem);
  font-weight: 400;
  font-style: italic;
  color: var(--roseLight);
  letter-spacing: 0.06em;
  text-shadow: 0 2px 20px rgba(200,80,100,0.4);
  margin-bottom: 12px;
}

.divider-line {
  display: flex; align-items: center; gap: 12px;
  margin: 12px 0;
  color: var(--gold); opacity: 0.55;
  font-size: 1.1rem;
}
.divider-line::before, .divider-line::after {
  content: '';
  flex: 1;
  height: 1px;
  background: linear-gradient(to right, transparent, var(--gold), transparent);
  opacity: 0.4;
}

.main-poem {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(1rem, 2.5vw, 1.2rem);
  font-style: italic;
  font-weight: 300;
  color: rgba(255,235,225,0.88);
  line-height: 2;
  letter-spacing: 0.03em;
  margin: 8px 0;
}

.signature {
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 1rem;
  color: rgba(212,160,66,0.7);
  letter-spacing: 0.1em;
  margin-top: 6px;
}

/* ========== MUSIC BAR ========== */
.music-bar {
  position: fixed; bottom: 24px; left: 50%;
  transform: translateX(-50%);
  display: flex; align-items: center; gap: 12px;
  background: rgba(10,2,5,0.72);
  border: 1px solid rgba(212,160,66,0.2);
  border-radius: 100px;
  padding: 10px 24px;
  backdrop-filter: blur(12px);
  z-index: 10;
  opacity: 0;
  animation: fadeIn 1s ease 2s forwards;
}
@keyframes fadeIn { to { opacity: 1; } }

.music-icon {
  font-size: 1.1rem;
  color: var(--gold);
  animation: musicBounce 1.2s ease-in-out infinite;
}
@keyframes musicBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-3px); }
}

.music-info {
  display: flex; flex-direction: column; gap: 4px;
}
.music-title {
  font-family: 'Cormorant Garamond', serif;
  font-style: italic;
  color: rgba(255,235,220,0.75);
  font-size: 0.82rem;
  letter-spacing: 0.08em;
  white-space: nowrap;
}

.music-wave {
  display: flex; align-items: flex-end; gap: 2px; height: 14px;
}
.music-wave span {
  display: block;
  width: 3px;
  background: linear-gradient(to top, var(--rose), var(--goldLight));
  border-radius: 2px;
  animation: wave 0.9s ease-in-out infinite alternate;
  transform-origin: bottom;
}
.music-wave span:nth-child(1) { height: 6px;  animation-delay: 0s; }
.music-wave span:nth-child(2) { height: 12px; animation-delay: 0.15s; }
.music-wave span:nth-child(3) { height: 8px;  animation-delay: 0.3s; }
.music-wave span:nth-child(4) { height: 10px; animation-delay: 0.1s; }
.music-wave span:nth-child(5) { height: 5px;  animation-delay: 0.25s; }
@keyframes wave {
  from { transform: scaleY(0.4); }
  to   { transform: scaleY(1); }
}

/* ========== SCROLLBAR ========== */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--rose); border-radius: 4px; }

/* ========== PORTRAIT TOGGLE HINT ========== */
#toggleHint {
  position: fixed;
  top: 20px; left: 50%;
  transform: translateX(-50%);
  font-family: 'IM Fell English', serif;
  font-style: italic;
  font-size: 0.78rem;
  letter-spacing: 0.12em;
  color: rgba(255,220,210,0.7);
  background: rgba(10,2,5,0.55);
  border: 1px solid rgba(212,160,66,0.18);
  border-radius: 100px;
  padding: 6px 20px;
  z-index: 20;
  opacity: 0;
  transition: opacity 0.8s ease;
  pointer-events: none;
  white-space: nowrap;
}